<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="adminDB.title"><%= __("adminDB.title") %></title>
    <script src="https://cdn.tailwindcss.com/3.4.16"></script>
    <script>tailwind.config={theme:{extend:{colors:{primary:'#9b4f88',secondary:'#6b7280'},borderRadius:{'none':'0px','sm':'4px',DEFAULT:'8px','md':'12px','lg':'16px','xl':'20px','2xl':'24px','3xl':'32px','full':'9999px','button':'8px'}}}}</script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css">
    <link rel="stylesheet" href="/css/admin_database.css">
    <link rel="stylesheet" href="/css/Bienvenida-y-Opciones.css" />
</head>
<body>
    <%- include('header') %>

    <div class="container">
        <div id="alertSuccess" class="alert alert-success" style="display: none;"></div>
        <div id="alertError" class="alert alert-error" style="display: none;"></div>

        <div class="models-grid">
            <% tables.forEach(table => { %>
                <div class="model-card" onclick="loadTable('<%= table.name %>')">
                    <div class="model-name"><%= table.name %></div>
                    <div class="model-count" data-i18n="adminDB.clickToView"><%= __("adminDB.clickToView") %></div>
                </div>
            <% }); %>
        </div>

        <div id="contentArea" style="display: none;">
            <div class="content-header">
                <h2 id="contentTitle" data-i18n="adminDB.table"><%= __("adminDB.table") %></h2>
                <div class="action-buttons">
                    <button id="btnFilters" class="btn btn-secondary" onclick="toggleFilters()">
                        <i class="ri-search-line"></i> <span data-i18n="adminDB.search"><%= __("adminDB.search") %></span>
                    </button>
                    <button id="btnCreate" class="btn btn-primary" onclick="showCreateModal()">
                        <i class="ri-add-line"></i> <span data-i18n="adminDB.create"><%= __("adminDB.create") %></span>
                    </button>
                    <button id="btnCreateMultiple" class="btn btn-primary" onclick="showCreateModal(true)">
                        <i class="ri-file-add-line"></i> <span data-i18n="adminDB.createMultiple"><%= __("adminDB.createMultiple") %></span>
                    </button>
                    <button id="btnUpdateMultiple" class="btn btn-warning" onclick="showUpdateModal()">
                        <i class="ri-edit-line"></i> <span data-i18n="adminDB.updateMultiple"><%= __("adminDB.updateMultiple") %></span>
                    </button>
                    <button id="btnDeleteMultiple" class="btn btn-danger" onclick="showDeleteModal()">
                        <i class="ri-delete-bin-line"></i> <span data-i18n="adminDB.deleteMultiple"><%= __("adminDB.deleteMultiple") %></span>
                    </button>
                    <button id="btnRefresh" class="btn btn-secondary" onclick="refreshTable()">
                        <i class="ri-refresh-line"></i> <span data-i18n="adminDB.refresh"><%= __("adminDB.refresh") %></span>
                    </button>
                </div>
            </div>

            <!-- Filtro específico para tabla agenda -->
            <div id="agendaDateFilter" class="agenda-date-filter" style="display: none;">
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                    <h3 class="text-sm font-semibold text-blue-800 mb-3">
                        <i class="ri-calendar-line"></i> <span data-i18n="adminDB.filterByDate"><%= __("adminDB.filterByDate") %></span>
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="form-group">
                            <label class="text-xs text-gray-600" data-i18n="adminDB.startDate"><%= __("adminDB.startDate") %></label>
                            <input type="date" id="agendaDateStart" class="w-full border rounded p-2">
                        </div>
                        <div class="form-group">
                            <label class="text-xs text-gray-600" data-i18n="adminDB.endDate"><%= __("adminDB.endDate") %></label>
                            <input type="date" id="agendaDateEnd" class="w-full border rounded p-2">
                        </div>
                        <div class="form-group flex items-end gap-2">
                            <button onclick="applyAgendaDateFilter()" class="btn btn-primary flex-1">
                                <i class="ri-search-line"></i> <span data-i18n="adminDB.searchBtn"><%= __("adminDB.searchBtn") %></span>
                            </button>
                            <button onclick="clearAgendaDateFilter()" class="btn btn-secondary flex-1">
                                <i class="ri-close-line"></i> <span data-i18n="adminDB.clear"><%= __("adminDB.clear") %></span>
                            </button>
                        </div>
                    </div>
                    <p class="text-xs text-gray-500 mt-2">
                        <i class="ri-information-line"></i> 
                        <span data-i18n="adminDB.dateFilterHelp"><%= __("adminDB.dateFilterHelp") %></span>
                    </p>
                </div>
            </div>

            <div id="filtersSection" class="filters-section" style="display: none;">
                <div class="filters-grid">
                    <div class="form-group">
                        <label data-i18n="adminDB.fieldToSearch"><%= __("adminDB.fieldToSearch") %></label>
                        <select id="filterField" class="w-full border rounded p-2">
                            <option value="" data-i18n="adminDB.selectField"><%= __("adminDB.selectField") %></option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label data-i18n="adminDB.valueToSearch"><%= __("adminDB.valueToSearch") %></label>
                        <input type="text" id="filterValue" class="w-full border rounded p-2" placeholder="<%= __('adminDB.enterValue') %>" data-i18n-placeholder="adminDB.enterValue">
                        <small class="text-gray-500" data-i18n="adminDB.dateFormatHelp"><%= __("adminDB.dateFormatHelp") %></small>
                    </div>
                </div>
                
                <!-- Sección de ordenamiento -->    
                <div class="filters-grid mt-4">
                    <div class="form-group">
                        <label data-i18n="adminDB.sortBy"><%= __("adminDB.sortBy") %></label>
                        <select id="sortField" class="w-full border rounded p-2">
                            <option value="" data-i18n="adminDB.noSort"><%= __("adminDB.noSort") %></option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label data-i18n="adminDB.order"><%= __("adminDB.order") %></label>
                        <select id="sortOrder" class="w-full border rounded p-2">
                            <option value="asc" data-i18n="adminDB.ascending"><%= __("adminDB.ascending") %></option>
                            <option value="desc" data-i18n="adminDB.descending"><%= __("adminDB.descending") %></option>
                        </select>
                    </div>
                </div>
                
                <div class="filter-actions">
                    <button class="btn btn-primary" onclick="applyFilters()"><span data-i18n="adminDB.searchBtn"><%= __("adminDB.searchBtn") %></span></button>
                    <button class="btn btn-secondary" onclick="clearFilters()"><span data-i18n="adminDB.clear"><%= __("adminDB.clear") %></span></button>
                </div>
            </div>

            <div id="tableContainer" class="table-container"></div>

            <div id="pagination" class="pagination" style="display: none;">
                <div id="paginationInfo" class="pagination-info"></div>
                <div id="paginationControls" class="pagination-controls"></div>
            </div>
        </div>
    </div>

    <div id="formModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle" data-i18n="adminDB.createNewRecord"><%= __("adminDB.createNewRecord") %></h3>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="recordForm" onsubmit="event.preventDefault(); saveRecord();">
                    <div id="multipleCheckbox" style="display: none;">
                        <label class="flex items-center gap-2 mb-4">
                            <input type="checkbox" id="enableMultiple" onchange="toggleMultipleMode()">
                            <span data-i18n="adminDB.enableMultipleMode"><%= __("adminDB.enableMultipleMode") %></span>
                        </label>
                    </div>
                    <div id="singleMode">
                        <div id="formFields"></div>
                    </div>
                    <div id="multipleMode" style="display: none;">
                        <div class="form-group">
                            <label data-i18n="adminDB.recordCount"><%= __("adminDB.recordCount") %></label>
                            <input type="number" id="recordCount" min="1" max="100" value="1" class="w-full border rounded p-2">
                        </div>
                        <div id="multipleFormFields"></div>
                    </div>
                    <div class="modal-actions">
                        <button type="submit" class="btn btn-primary" data-i18n="adminDB.save"><%= __("adminDB.save") %></button>
                        <button type="button" class="btn btn-secondary" onclick="closeModal()" data-i18n="common.cancel"><%= __("common.cancel") %></button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="updateModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 data-i18n="adminDB.updateMultipleRecords"><%= __("adminDB.updateMultipleRecords") %></h3>
                <span class="close" onclick="closeUpdateModal()">&times;</span>
            </div>
            <div class="modal-body">
                <h4 class="text-lg font-semibold mb-3" data-i18n="adminDB.filters"><%= __("adminDB.filters") %></h4>
                <div id="updateFilters" class="form-grid mb-6"></div>
                <h4 class="text-lg font-semibold mb-3" data-i18n="adminDB.newValues"><%= __("adminDB.newValues") %></h4>
                <div id="updateFields" class="form-grid mb-6"></div>
                <div class="modal-actions">
                    <button class="btn btn-primary" onclick="executeUpdate()" data-i18n="adminDB.update"><%= __("adminDB.update") %></button>
                    <button class="btn btn-secondary" onclick="closeUpdateModal()" data-i18n="common.cancel"><%= __("common.cancel") %></button>
                </div>
            </div>
        </div>
    </div>

    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 data-i18n="adminDB.deleteMultipleRecords"><%= __("adminDB.deleteMultipleRecords") %></h3>
                <span class="close" onclick="closeDeleteModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="alert alert-warning mb-4">
                    ⚠️ <strong data-i18n="adminDB.warningTitle"><%= __("adminDB.warningTitle") %></strong> <span data-i18n="adminDB.deleteWarning"><%= __("adminDB.deleteWarning") %></span>
                </div>
                <h4 class="text-lg font-semibold mb-3" data-i18n="adminDB.deleteFilters"><%= __("adminDB.deleteFilters") %></h4>
                <div id="deleteFilters" class="form-grid mb-6"></div>
                <div class="modal-actions">
                    <button class="btn btn-danger" onclick="executeDelete()" data-i18n="adminDB.delete"><%= __("adminDB.delete") %></button>
                    <button class="btn btn-secondary" onclick="closeDeleteModal()" data-i18n="common.cancel"><%= __("common.cancel") %></button>
                </div>
            </div>
        </div>
    </div>

    <%- include('footer') %>

    <script>
        window.i18nAdminDB = {
            title: "<%= __('adminDB.title') %>",
            clickToView: "<%= __('adminDB.clickToView') %>",
            table: "<%= __('adminDB.table') %>",
            search: "<%= __('adminDB.search') %>",
            create: "<%= __('adminDB.create') %>",
            createMultiple: "<%= __('adminDB.createMultiple') %>",
            updateMultiple: "<%= __('adminDB.updateMultiple') %>",
            deleteMultiple: "<%= __('adminDB.deleteMultiple') %>",
            createMultiple2: "<%= __('adminDB.createMultiple2') %>",
            refresh: "<%= __('adminDB.refresh') %>",
            filterByDate: "<%= __('adminDB.filterByDate') %>",
            startDate: "<%= __('adminDB.startDate') %>",
            endDate: "<%= __('adminDB.endDate') %>",
            searchBtn: "<%= __('adminDB.searchBtn') %>",
            clear: "<%= __('adminDB.clear') %>",
            dateFilterHelp: "<%= __('adminDB.dateFilterHelp') %>",
            fieldToSearch: "<%= __('adminDB.fieldToSearch') %>",
            selectField: "<%= __('adminDB.selectField') %>",
            valueToSearch: "<%= __('adminDB.valueToSearch') %>",
            enterValue: "<%= __('adminDB.enterValue') %>",
            dateFormatHelp: "<%= __('adminDB.dateFormatHelp') %>",
            sortBy: "<%= __('adminDB.sortBy') %>",
            noSort: "<%= __('adminDB.noSort') %>",
            order: "<%= __('adminDB.order') %>",
            ascending: "<%= __('adminDB.ascending') %>",
            descending: "<%= __('adminDB.descending') %>",
            createNewRecord: "<%= __('adminDB.createNewRecord') %>",
            enableMultipleMode: "<%= __('adminDB.enableMultipleMode') %>",
            recordCount: "<%= __('adminDB.recordCount') %>",
            save: "<%= __('adminDB.save') %>",
            cancel: "<%= __('common.cancel') %>",
            updateMultipleRecords: "<%= __('adminDB.updateMultipleRecords') %>",
            filters: "<%= __('adminDB.filters') %>",
            newValues: "<%= __('adminDB.newValues') %>",
            update: "<%= __('adminDB.update') %>",
            deleteMultipleRecords: "<%= __('adminDB.deleteMultipleRecords') %>",
            warningTitle: "<%= __('adminDB.warningTitle') %>",
            deleteWarning: "<%= __('adminDB.deleteWarning') %>",
            deleteFilters: "<%= __('adminDB.deleteFilters') %>",
            delete: "<%= __('adminDB.delete') %>",
            loadingData: "<%= __('adminDB.loadingData') %>",
            noData: "<%= __('adminDB.noData') %>",
            clickToSort: "<%= __('adminDB.clickToSort') %>",
            actions: "<%= __('adminDB.actions') %>",
            edit: "<%= __('adminDB.edit') %>",
            confirmDelete: "<%= __('adminDB.confirmDelete') %>",
            recordDeleted: "<%= __('adminDB.recordDeleted') %>",
            deleteError: "<%= __('adminDB.deleteError') %>",
            showing: "<%= __('adminDB.showing') %>",
            records: "<%= __('adminDB.records') %>",
            loadMore: "<%= __('adminDB.loadMore') %>",
            selectPlaceholder: "<%= __('adminDB.selectPlaceholder') %>",
            random: "<%= __('adminDB.random') %>",
            all: "<%= __('adminDB.all') %>",
            noModify: "<%= __('adminDB.noModify') %>",
            optional: "<%= __('adminDB.optional') %>",
            ifNotSpecified: "<%= __('adminDB.ifNotSpecified') %>",
            required: "<%= __('adminDB.required') %>",
            completeAllFields: "<%= __('adminDB.completeAllFields') %>",
            noBoxesAvailable: "<%= __('adminDB.noBoxesAvailable') %>",
            generatingSchedules: "<%= __('adminDB.generatingSchedules') %>",
            boxes: "<%= __('adminDB.boxes') %>",
            schedulesCreated: "<%= __('adminDB.schedulesCreated') %>",
            scheduleCreateError: "<%= __('adminDB.scheduleCreateError') %>",
            noSchedulesGenerated: "<%= __('adminDB.noSchedulesGenerated') %>",
            recordUpdated: "<%= __('adminDB.recordUpdated') %>",
            recordCreated: "<%= __('adminDB.recordCreated') %>",
            saveErrorGeneric: "<%= __('adminDB.saveErrorGeneric') %>",
            connectionError: "<%= __('adminDB.connectionError') %>",
            specifyAtLeastOneFilter: "<%= __('adminDB.specifyAtLeastOneFilter') %>",
            specifyAtLeastOneField: "<%= __('adminDB.specifyAtLeastOneField') %>",
            recordsUpdated: "<%= __('adminDB.recordsUpdated') %>",
            updateError: "<%= __('adminDB.updateError') %>",
            absolutelySure: "<%= __('adminDB.absolutelySure') %>",
            recordsDeleted: "<%= __('adminDB.recordsDeleted') %>",
            deleteErrorGeneric: "<%= __('adminDB.deleteErrorGeneric') %>",
            allBoxes: "<%= __('adminDB.allBoxes') %>",
            probabilityInfo: "<%= __('adminDB.probabilityInfo') %>",
            noRecordsFound: "<%= __('adminDB.noRecordsFound') %>",
            in: "<%= __('adminDB.in') %>",
            recordsFoundSorted: "<%= __('adminDB.recordsFoundSorted') %>",
            sortedBy: "<%= __('adminDB.sortedBy') %>",
            notEditable: "<%= __('adminDB.notEditable') %>",
            date: "<%= __('adminDB.date') %>",
            time: "<%= __('adminDB.time') %>",
            enter: "<%= __('adminDB.enter') %>",
            consultationType: "<%= __('adminDB.consultationType') %>",
            userProfessional: "<%= __('adminDB.userProfessional') %>",
            state: "<%= __('adminDB.state') %>",
            patientAbsent: "<%= __('adminDB.patientAbsent') %>",
            box: "<%= __('adminDB.box') %>",
            showAsIds: "<%= __('adminDB.showAsIds') %>",
            showAsNames: "<%= __('adminDB.showAsNames') %>",
            adminDbLoaded: "<%= __('adminDB.adminDbLoaded') %>",
            minutes: "<%= __('adminDB.minutes') %>",
            schedulesMaintenance: "<%= __('adminDB.schedulesMaintenance') %>",
            startTime: "<%= __('adminDB.startTime') %>",
            endTime: "<%= __('adminDB.endTime') %>",
            editEventTitle: "<%= __('agenda.editEventTitle') %>",
            error: "<%= __('common.error') %>",
            info: "<%= __('common.info') %>"
        };        
    </script>
    <script src="/js/admin_database.js"></script>

</body>
</html>