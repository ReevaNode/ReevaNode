name: CI - Reeva

on:
  push:
    branches:
      - "**"

jobs:
  ci:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Use Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 20

      - name: Instalar dependencias globales
        run: |
          npm install -g serverless

      - name: Instalar dependencias del proyecto
        run: |
          echo "Instalando dependencias..."
          cd aws-cognito-jwt-login && npm install || true
          cd ../Reeva_node && npm install || true

      - name: Buscar archivos serverless.yml
        run: |
          echo "Buscando serverless.yml..."
          find . -name "serverless.yml"

      - name: Validar sintaxis Serverless (serverless print)
        run: |
          echo "Validando sintaxis..."
          for file in $(find . -name "serverless.yml"); do
            echo "Validando: $file"
            cd $(dirname $file)
            serverless print || exit 1
            cd -
          done

      - name: Finalizar CI
        run: echo "CI ejecutado correctamente"
